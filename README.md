## DHCP Client Join Notification for OpenWrt

Этот проект предоставляет скрипт для OpenWrt, который автоматически отправляет уведомления в Telegram при подключении новых устройств к вашей сети через DHCP.

### Описание

Скрипт размещается в `/etc/hotplug.d/dhcp/` и срабатывает при событиях `add` или `update` от DHCP-сервера `dnsmasq`. Он анализирует системные логи для получения информации о новом клиенте (IP, MAC, Hostname) и отправляет структурированное сообщение в указанный чат Telegram через бота.

### Функции

*   **Автоматическое обнаружение:** Отслеживает события подключения DHCP клиентов.
*   **Уведомления в Telegram:** Отправляет подробные сообщения с информацией о новом устройстве.
*   **Логирование:** Записывает события и ошибки в системный лог (`logread`).
*   **Управление списком клиентов:** Ведет список подключенных клиентов в `/tmp/wifi_clients.txt`, предотвращая дубликаты по IP.
*   **Безопасность:** Экранирует специальные символы для корректного отображения в Telegram.
*   **Конфигурация через UCI:** Использует стандартную систему конфигурации OpenWrt.

### Установка

1.  **Создайте скрипт:**
    *   Создайте файл `/etc/hotplug.d/dhcp/98-client-join-notification`.
    *   Скопируйте в него содержимое скрипта (см. `98-client-join-notification`).
    *   Сделайте его исполняемым: `chmod +x /etc/hotplug.d/dhcp/98-client-join-notification`.

2.  **Настройте конфигурацию UCI:**
    *   Добавьте следующую конфигурацию в файл `/etc/config/telegram-bot`:
        ```config
        config telegram-bot 'config'
                option bot_token 'YOUR_BOT_TOKEN'
                option chat_id 'YOUR_CHAT_ID'
        ```
    *   Замените `YOUR_BOT_TOKEN` и `YOUR_CHAT_ID` на реальные значения.
    *   Примените изменения: `uci commit telegram-bot`.

3.  **(Опционально) Создайте тестовый скрипт:**
    *   Создайте файл `/usr/bin/test_dhcp_notify.sh` (см. `test_dhcp_notify.sh`).
    *   Сделайте его исполняемым: `chmod +x /usr/bin/test_dhcp_notify.sh`.

### Использование

*   Скрипт автоматически запускается при подключении новых DHCP-клиентов.
*   Для тестирования используйте скрипт `/usr/bin/test_dhcp_notify.sh`.
*   Просмотр логов: `logread -e 'dhcp-join-notify'`.

### Файлы

*   `98-client-join-notification`: Основной скрипт уведомлений.
*   `test_dhcp_notify.sh`: Скрипт для ручного тестирования.
*   `/etc/config/telegram-bot`: Конфигурационный файл UCI.

### Зависимости

*   OpenWrt (проверено на версиях 23, 24)
*   `curl`
*   `uci`
*   `logread`
*   `dnsmasq` (для генерации DHCPACK логов)

### Лицензия

MIT
